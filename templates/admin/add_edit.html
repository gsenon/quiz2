
{% extends "base.html" %}
{% block title %}{{ 'Редактировать' if q else 'Добавить' }} вопрос{% endblock %}
{% block content %}
<section class="card">
  <h1>{{ 'Редактировать' if q else 'Добавить' }} вопрос</h1>
  <form method="post" class="form">
    <div class="grid">
      <div>
        <label>Тип</label>
        <select name="type" required onchange="toggleBlocks(this.value)">
          {% set t = q.type if q else '' %}
          <option value="single_choice" {{ 'selected' if t=='single_choice' }}>Один ответ</option>
          <option value="multiple_choice" {{ 'selected' if t=='multiple_choice' }}>Несколько ответов</option>
          <option value="fill_blank" {{ 'selected' if t=='fill_blank' }}>Заполнить пропуск</option>
          <option value="open_question" {{ 'selected' if t=='open_question' }}>Открытый</option>
          <option value="matching" {{ 'selected' if t=='matching' }}>Сопоставление</option>
        </select>
      </div>
      <div>
        <label>Линия</label>
        <select name="level" required>
          {% set lv = q.level if q else 'L2' %}
          <option value="L1" {{ 'selected' if lv=='L1' }}>L1</option>
          <option value="L2" {{ 'selected' if lv=='L2' }}>L2</option>
        </select>
      </div>
      <div>
        <label>Вес</label>
        <input type="number" name="weight" min="1" max="10" value="{{ q.weight if q else 1 }}" required>
      </div>
    </div>

    <label>Текст вопроса</label>
    <textarea name="question" rows="3" required>{{ q.question if q else '' }}</textarea>

    <div id="block-choice" class="type-block">
      <div class="grid">
        <div>
          <label>Варианты ответа (каждый с новой строки)</label>
          <textarea name="options" rows="6">{% if q and q.type in ['single_choice','multiple_choice'] %}{{ q.options | join('\n') }}{% endif %}</textarea>
        </div>
        <div>
          <label>Правильные ответы (каждый с новой строки)</label>
          <textarea name="correct" rows="6">{% if q and q.type in ['single_choice','multiple_choice'] %}{{ q.correct | join('\n') }}{% endif %}</textarea>
        </div>
      </div>
    </div>

    <div id="block-fill" class="type-block">
      <label>Правильное значение</label>
      <input type="text" name="correct_single" value="{% if q and q.type=='fill_blank' %}{{ q.correct[0] }}{% endif %}">
    </div>

    <div id="block-open" class="type-block">
      <label>Ключевые фразы (каждая с новой строки)</label>
      <textarea name="phrases" rows="4">{% if q and q.type=='open_question' %}{{ q.correct_phrases | join('\n') }}{% endif %}</textarea>
    </div>

    <div id="block-match" class="type-block">
      <label>Пары (формат: A->B, каждая с новой строки)</label>
      <textarea name="pairs" rows="6">{% if q and q.type=='matching' %}{% for p in q.pairs %}{{ p[0] }}->{{ p[1] }}\n{% endfor %}{% endif %}</textarea>
    </div>

    <div class="actions">
      <button type="submit">{{ 'Сохранить' if q else 'Добавить' }}</button>
      <a class="btn-secondary" href="{{ url_for('admin_dashboard') }}">Отмена</a>
    </div>
  </form>
</section>

<script>
function toggleBlocks(type) {
  const blocks = ['block-choice','block-fill','block-open','block-match'];
  blocks.forEach(id => document.getElementById(id).style.display='none');
  if (type === 'single_choice' || type === 'multiple_choice') document.getElementById('block-choice').style.display='block';
  if (type === 'fill_blank') document.getElementById('block-fill').style.display='block';
  if (type === 'open_question') document.getElementById('block-open').style.display='block';
  if (type === 'matching') document.getElementById('block-match').style.display='block';
}
toggleBlocks('{{ q.type if q else "single_choice" }}');
</script>
{% endblock %}
